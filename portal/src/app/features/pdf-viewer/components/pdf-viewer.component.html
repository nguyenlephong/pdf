<!-- PDF File Upload Area -->
<div *ngIf="!(pdfFile$ | async)" class="file-upload" 
     (dragover)="isDragActive = true" 
     (dragleave)="isDragActive = false" 
     (drop)="onDrop($event.dataTransfer?.files ? Array.from($event.dataTransfer.files) : [])">
  <input type="file" 
         accept=".pdf" 
         (change)="onFileSelected($event)" 
         style="display: none;" 
         #fileInput>
  
  <div *ngIf="isDragActive" class="drag-active">
    <p>Drop the PDF file here...</p>
  </div>
  
  <div *ngIf="!isDragActive" class="upload-prompt">
    <p>Drag & drop a PDF file here, or click to select</p>
    <button class="button" (click)="fileInput.click()">
      Choose PDF File
    </button>
  </div>
</div>

<!-- PDF Viewer -->
<div *ngIf="pdfFile$ | async" class="pdf-viewer">
  <!-- PDF Controls -->
  <div class="pdf-controls">
    <button class="button" (click)="toggleAddingField()">
      <span *ngIf="isAddingField$ | async">Cancel Adding Field</span>
      <span *ngIf="!(isAddingField$ | async)">Add Text Field</span>
    </button>
    
    <div class="grid-controls">
      <label>
        <input type="checkbox" 
               [checked]="snapToGrid$ | async" 
               (change)="setSnapToGrid($event.target.checked)">
        Snap to Grid
      </label>
      <div *ngIf="snapToGrid$ | async" class="grid-size-control">
        <span>Size:</span>
        <input type="number" 
               [value]="gridSize$ | async" 
               (change)="setGridSize(+$event.target.value)"
               min="5" 
               max="50">
      </div>
    </div>
    
    <div class="page-controls">
      <button class="button" 
              (click)="setCurrentPage((currentPage$ | async)! - 1)"
              [disabled]="(currentPage$ | async)! <= 1">
        Previous
      </button>
      <span>Page {{ currentPage$ | async }} of {{ totalPages$ | async }}</span>
      <span class="field-count">
        ({{ (currentPageFormFields$ | async)?.length || 0 }} fields)
      </span>
      <button class="button" 
              (click)="setCurrentPage((currentPage$ | async)! + 1)"
              [disabled]="(currentPage$ | async)! >= (totalPages$ | async)!">
        Next
      </button>
    </div>

    <div class="scale-controls">
      <button class="button" (click)="setScale(Math.max(0.5, ((scale$ | async)! - 0.1)))">
        Zoom Out
      </button>
      <span>{{ Math.round((scale$ | async)! * 100) }}%</span>
      <button class="button" (click)="setScale(Math.min(2.0, ((scale$ | async)! + 0.1)))">
        Zoom In
      </button>
    </div>
  </div>

  <!-- PDF Page Container -->
  <div class="pdf-page-container" 
       #pageRef
       (click)="handlePageClick($event)"
       [style.cursor]="(isAddingField$ | async) ? 'crosshair' : 'default'">
    
    <!-- PDF.js viewer would go here -->
    <!-- For now, we'll use a placeholder -->
    <div class="pdf-placeholder" 
         [style.transform]="'scale(' + (scale$ | async) + ')'"
         [style.transform-origin]="'top left'">
      <div class="pdf-page">
        <!-- PDF content would be rendered here -->
        <div class="page-content">
          <p>PDF Page {{ currentPage$ | async }}</p>
          <p>Scale: {{ scale$ | async }}</p>
        </div>
      </div>
    </div>

    <!-- Grid overlay when snap to grid is enabled -->
    <div *ngIf="snapToGrid$ | async" 
         class="grid-overlay"
         [style.background-size]="(gridSize$ | async)! * (scale$ | async)! + 'px ' + (gridSize$ | async)! * (scale$ | async)! + 'px'">
    </div>

    <!-- Form field overlays for current page -->
    <ng-container *ngIf="currentPageFormFields$ | async as currentPageFields">
      <app-form-field-overlay
        *ngFor="let field of currentPageFields; trackBy: trackByFieldId"
        [field]="field"
        [scale]="scale$ | async"
        [isSelected]="(selectedField$ | async)?.id === field.id"
        [allFields]="formFields$ | async"
        [snapToGrid]="snapToGrid$ | async"
        [gridSize]="gridSize$ | async"
        (fieldClick)="handleFieldSelect(field)"
        (fieldMove)="handleFieldMove(field.id, $event.x, $event.y, $event.isValidPosition)"
        (fieldResize)="handleFieldResize(field.id, $event.width, $event.height)"
        (fieldDelete)="handleDeleteField(field.id)">
      </app-form-field-overlay>
    </ng-container>
  </div>

  <!-- Adding field hint -->
  <div *ngIf="isAddingField$ | async" class="adding-field-hint">
    <p>Click on the PDF to add a text field</p>
    <p class="hint-text">Fields will be positioned to avoid overlaps</p>
  </div>
</div>
