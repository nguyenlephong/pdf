<div class="config-panel">
  <!-- Form Fields List -->
  <div class="config-section">
    <h3>Form Fields ({{ (formFields$ | async)?.length || 0 }})</h3>
    
    <div *ngIf="(formFields$ | async)?.length === 0; else fieldsList" class="no-fields">
      <p>No form fields added yet. Click "Add Text Field" in the PDF viewer to get started.</p>
    </div>

    <ng-template #fieldsList>
      <div class="fields-list">
        <div *ngFor="let field of formFields$ | async; trackBy: trackByFieldId" 
             class="field-item"
             [class.selected]="(selectedField$ | async)?.id === field.id"
             (click)="selectField(field)">
          <strong>{{ field.label }}</strong>
          <br>
          <small>{{ field.name }} ({{ field.type }}) - Page {{ field.pageNumber }}</small>
        </div>
      </div>
    </ng-template>
  </div>

  <!-- Field Configuration -->
  <div *ngIf="selectedField$ | async as selectedField" class="config-section">
    <h3>Field Configuration</h3>
    
    <div class="form-group">
      <label>Field Label:</label>
      <input type="text" 
             [value]="selectedField.label" 
             (input)="handleFieldUpdate('label', $event.target.value)">
    </div>

    <div class="form-group">
      <label>Field Name:</label>
      <input type="text" 
             [value]="selectedField.name" 
             (input)="handleFieldUpdate('name', $event.target.value)">
    </div>

    <div class="form-group">
      <label>Field Type:</label>
      <select [value]="selectedField.type" 
              (change)="handleFieldUpdate('type', $event.target.value)">
        <option value="text">Text</option>
        <option value="date">Date</option>
        <option value="number">Number</option>
        <option value="email">Email</option>
      </select>
    </div>

    <div class="form-group">
      <label>Placeholder:</label>
      <input type="text" 
             [value]="selectedField.placeholder || ''" 
             (input)="handleFieldUpdate('placeholder', $event.target.value)">
    </div>

    <div class="form-group">
      <label>Page Number:</label>
      <input type="number" 
             [value]="selectedField.pageNumber" 
             (input)="handleFieldUpdate('pageNumber', parseInt($event.target.value))"
             min="1" max="999">
    </div>

    <div class="form-group">
      <label>Position & Size:</label>
      <div class="position-controls">
        <div class="control-group">
          <label>X:</label>
          <input type="number" 
                 [value]="Math.round(selectedField.x)" 
                 (input)="handleFieldUpdate('x', parseInt($event.target.value))">
        </div>
        <div class="control-group">
          <label>Y:</label>
          <input type="number" 
                 [value]="Math.round(selectedField.y)" 
                 (input)="handleFieldUpdate('y', parseInt($event.target.value))">
        </div>
        <div class="control-group">
          <label>Width:</label>
          <input type="number" 
                 [value]="Math.round(selectedField.width)" 
                 (input)="handleFieldUpdate('width', parseInt($event.target.value))">
        </div>
        <div class="control-group">
          <label>Height:</label>
          <input type="number" 
                 [value]="Math.round(selectedField.height)" 
                 (input)="handleFieldUpdate('height', parseInt($event.target.value))">
        </div>
      </div>
    </div>

    <div class="form-group">
      <label>Font Size:</label>
      <input type="number" 
             [value]="selectedField.fontSize" 
             (input)="handleFieldUpdate('fontSize', parseInt($event.target.value))"
             min="8" max="24">
    </div>

    <div class="form-group">
      <label>Text Color:</label>
      <input type="color" 
             [value]="selectedField.color" 
             (input)="handleFieldUpdate('color', $event.target.value)">
    </div>

    <div class="form-group">
      <label class="checkbox-label">
        <input type="checkbox" 
               [checked]="selectedField.required" 
               (change)="handleFieldUpdate('required', $event.target.checked)">
        Required Field
      </label>
    </div>

    <button class="button danger" (click)="handleDeleteSelected()">
      Delete Field
    </button>
  </div>

  <!-- PDF Actions -->
  <div class="config-section">
    <h3>PDF Actions</h3>
    
    <button class="button success" 
            (click)="exportPDFWithConfig()"
            [disabled]="!(formFields$ | async)?.length || !(pdfFile$ | async)">
      Export PDF + Config
    </button>
    
    <button class="button" 
            (click)="$event.target.nextElementSibling.click()">
      Import PDF + Config
    </button>
    <input type="file" 
           accept=".pdf,.json" 
           multiple 
           (change)="onFileSelected($event, 'both')"
           style="display: none;">

    <button class="button" 
            (click)="$event.target.nextElementSibling.click()">
      Import PDF Only
    </button>
    <input type="file" 
           accept=".pdf" 
           (change)="onFileSelected($event, 'pdf')"
           style="display: none;">

    <button class="button" 
            (click)="$event.target.nextElementSibling.click()">
      Import Config Only
    </button>
    <input type="file" 
           accept=".json" 
           (change)="onFileSelected($event, 'config')"
           style="display: none;">
  </div>
</div>
